<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Meteo archiv – jednoduchý graf</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.js"></script>
  <style>
    /* ... (tvé původní styly beze změn) ... */
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Meteo archiv</h1>
    <div class="sub">Zdroj: <code>tmep.cz</code> · CSV archiv · levá osa °C, pravá osa %</div>

    <div class="controls">
      <label class="chip"><input type="checkbox" id="showTemp" checked> Teplota (°C)</label>
      <label class="chip"><input type="checkbox" id="showHum" checked> Vlhkost (%)</label>

      <div class="chip">
        Rozsah:
        <select id="range">
          <option value="all" selected>Vše</option>
          <option value="30d">Posledních 30 dní</option>
          <option value="7d">Posledních 7 dní</option>
          <option value="today">Dnes</option>
          <option value="custom">Vlastní…</option>
        </select>
      </div>

      <div class="chip" id="customRange" style="display:none">
        <label>Od: <input type="date" id="fromDate"></label>
        <label>Do: <input type="date" id="toDate"></label>
        <button id="applyRange" type="button">Použít</button>
      </div>

      <!-- NOVÉ: výběr souboru -->
      <div class="chip">
        Soubor:
        <select id="fileSelect">
          <option value="data/history.csv" selected>Aktuální měsíc</option>
          <option value="data/history_2025_09.csv">2025-09</option>
          <option value="data/history_2025_08.csv">2025-08</option>
          <!-- můžeš přidávat ručně další -->
        </select>
      </div>

      <div class="chip srcs" id="srcToggles" title="Zap/vyp stanice"></div>

      <button id="theme">🌓 Režim</button>
      <a id="dlCsv" class="muted" href="#" download="history.csv">Stáhnout CSV</a>
    </div>

    <!-- ... tvůj zbytek beze změn ... -->

<script>
(() => {
  const csvLink = document.getElementById('dlCsv');
  const fileSelect = document.getElementById('fileSelect'); // NOVÉ

  async function loadCsv(fileName = fileSelect.value) { // NOVÉ
    try {
      const r = await fetch(fileName, { cache: 'no-store' });
      if (r.ok) {
        csvLink.href = fileName;
        return await r.text();
      }
    } catch(e){}
    throw new Error('CSV soubor nebyl nalezen: ' + fileName);
  }

  // ... parseCsv, buildLabels, rangeFilter, makeDatasets, updateExtremes zůstávají stejné ...

  // ---------- Stav ----------
  let chart, RAW=[], sources=[], enabledSrc={}, currentRange='all', currentFrom='', currentTo='';

  async function reload(fileName) { // NOVÉ
    try {
      const text = await loadCsv(fileName);
      RAW = parseCsv(text);
      sources = unique(RAW.map(r=>r.src)).sort();
      enabledSrc = {};
      const togglesEl = document.getElementById('srcToggles');
      togglesEl.innerHTML = '';
      sources.forEach(src => {
        enabledSrc[src]=true;
        const id='src_'+src.replace(/\W/g,'_');
        const lbl=document.createElement('label'); lbl.className='chip';
        lbl.innerHTML = `<input type="checkbox" id="${id}" data-src="${src}" checked> Stanice ${src}`;
        lbl.addEventListener('change', e => { enabledSrc[src] = e.target.checked; redraw(); });
        togglesEl.appendChild(lbl);
      });
      redraw();
    } catch(err) {
      console.error(err);
      alert('Nepodařilo se načíst data: '+fileName);
    }
  }

  // ---------- DOM eventy ----------
  document.getElementById('showTemp').addEventListener('change', redraw);
  document.getElementById('showHum').addEventListener('change', redraw);
  document.getElementById('range').addEventListener('change', () => {
    currentRange = range.value;
    customRange.style.display = (currentRange === 'custom') ? 'inline-flex' : 'none';
    if (currentRange !== 'custom') { currentFrom=''; currentTo=''; fromDate.value=''; toDate.value=''; }
    redraw();
  });
  document.getElementById('applyRange').addEventListener('click', () => {
    currentFrom = fromDate.value || '';
    currentTo   = toDate.value   || '';
    redraw();
  });
  fileSelect.addEventListener('change', () => reload(fileSelect.value)); // NOVÉ

  // ---------- Start ----------
  reload(fileSelect.value); // načíst vybraný soubor
})();
</script>
</body>
</html>
